# 매수수량 고정주식수 버그 수정

## 발견 시간
2025-08-27

## 문제 상황
사용자가 매수 수량 옵션 중 '5주', '10주' 같은 고정 주식수 방식이 의도와 다르게 작동한다고 보고함.
- 예상: 초기 자본과 초기 주가로 계산한 고정 주식수만 매수
- 실제: 매수 시점의 현재가격으로 계산하여 주가 변동에 따라 매수 금액이 달라짐

## 원인 분석
`최적화_투자_분석.py` 파일의 시뮬레이션 로직에서:
```python
# 문제 코드 (라인 3152-3154)
else:  # 초기 설정 고정 주식수 방식
    매수금액 = min(현재가격 * 매수수량, 자본)
```
매수할 때마다 현재가격으로 계산하여 주가 변동에 따라 매수 금액이 달라지는 문제 발생.

## 해결 방법

### 1. 전략 생성 시점 수정 (라인 1438-1450)
```python
# 구매방식 2인 경우 초기 자본과 초기 가격으로 실제 주식수 계산
실제매수수량 = 매수수량['수량']
if 매수수량['방식'] == '2':
    필요자본 = self.초기가격 * 매수수량['수량']
    if 필요자본 > 100000:
        # 자본 부족 시 최대 구매 가능 수량으로 조정
        실제매수수량 = int(100000 / self.초기가격)
    else:
        실제매수수량 = 매수수량['수량']
```

### 2. 시뮬레이션 실행 수정 (라인 3149-3157)
```python
if 구매방식 == "1":  # 퍼센트 방식
    매수금액 = 자본 * 매수수량
    매수주식 = 매수금액 / 현재가격
else:  # 고정 주식수 방식
    매수주식 = 매수수량  # 이미 주식수로 설정됨
    매수금액 = min(현재가격 * 매수주식, 자본)
```

### 3. 시나리오 시뮬레이션 수정 (라인 2987-2994)
동일한 로직으로 수정

## 결과
- 5주, 10주 같은 고정 주식수 옵션이 초기 자본과 초기 주가를 기준으로 계산됨
- 자본이 늘거나 줄어도 항상 동일한 수량만 매수하도록 수정 완료
- 확신도: 98%

## 교훈
매수 방식별 로직을 명확히 구분하고, 고정값은 초기에 한 번만 계산해야 함.